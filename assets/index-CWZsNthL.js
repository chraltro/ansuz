import ke,{useRef as V,useState as N,useEffect as te,useMemo as K,useCallback as X}from"react";import Ne from"react-dom/client";import ce from"react-markdown";import de from"remark-gfm";import{Prism as Se}from"react-syntax-highlighter";import{atomDark as le}from"react-syntax-highlighter/dist/esm/styles/prism";import{GoogleGenAI as Ae}from"@google/genai";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();var ie={exports:{}},Z={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pe;function Ce(){if(pe)return Z;pe=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function n(o,s,l){var r=null;if(l!==void 0&&(r=""+l),s.key!==void 0&&(r=""+s.key),"key"in s){l={};for(var u in s)u!=="key"&&(l[u]=s[u])}else l=s;return s=l.ref,{$$typeof:t,type:o,key:r,ref:s!==void 0?s:null,props:l}}return Z.Fragment=a,Z.jsx=n,Z.jsxs=n,Z}var he;function Ee(){return he||(he=1,ie.exports=Ce()),ie.exports}var e=Ee();const ee=25,Pe=({onProjectReady:t,setIsLoading:a})=>{const n=V(null),o=V(null),[s,l]=N(!1),[r,u]=N(""),[p,c]=N("pasted-code"),w=d=>{var v,I;d==="file"?(v=n.current)==null||v.click():(I=o.current)==null||I.click()},P=async d=>{const v=d.target.files;if(!v||v.length===0)return;if(v.length>ee){alert(`Error: Too many files selected (${v.length}). This tool supports up to ${ee} files at once. Please select fewer files or break your upload into smaller batches.`),d.target&&(d.target.value="");return}a(!0);const I={name:"root",content:null,children:[],path:""},O=[];for(const T of Array.from(v)){const F=(T.webkitRelativePath||T.name).split("/").filter(h=>h),m=new Promise((h,b)=>{const k=new FileReader;k.onload=M=>{let R=I;F.forEach((S,$)=>{var W;let U=R.children.find(Q=>Q.name===S);if(!U){const Q=$===F.length-1;U={name:S,content:Q?(W=M.target)==null?void 0:W.result:null,children:[],path:F.slice(0,$+1).join("/")},R.children.push(U)}R=U}),h()},k.onerror=b,k.readAsText(T)});O.push(m)}try{await Promise.all(O),t(I)}catch(T){console.error("Error reading files:",T)}finally{a(!1),d.target&&(d.target.value="")}},x=d=>{const v=/^------\s+([^\s].*?[./][^\s]*.*?)\s+------\s*\n/gm,I=Array.from(d.matchAll(v));if(I.length>0){const F=[];return I.forEach((m,h)=>{const b=m[1].trim(),k=b.split("/").pop()||b,M=m.index+m[0].length;let R=d.length;h<I.length-1&&(R=I[h+1].index);let S=d.substring(M,R).trim();const $=S.match(/^``````[\w]*\n?([\s\S]*?)\n?``````$/),U=S.match(/^```[\w]*\n?([\s\S]*?)\n?```$/);$?S=$[1]:U&&(S=U[1]),F.push({name:k,content:S,children:[],path:b})}),F}const O=/^###\s*`([^`]+)`\s*\n/gm,T=Array.from(d.matchAll(O));if(T.length>0){const F=[];return T.forEach((m,h)=>{const b=m[1],k=m.index+m[0].length;let M=d.length;h<T.length-1&&(M=T[h+1].index);let R=d.substring(k,M).trim();const S=R.match(/^```[\w]*\n([\s\S]*?)\n```$/);S&&(R=S[1]),F.push({name:b,content:R,children:[],path:b})}),F}const z=p.includes(".")?p:`${p}.txt`;return[{name:z,content:d,children:[],path:z}]},y=()=>{if(r.trim()){a(!0);try{const d=x(r);if(d.length>ee){alert(`Error: Too many files parsed (${d.length}). This tool supports up to ${ee} files at once. Please split your content into smaller batches.`);return}t({name:"root",content:null,children:d,path:""})}catch(d){console.error("Error processing pasted code:",d),alert("Error parsing the pasted content. Please check the format and try again.")}finally{a(!1),u(""),c("pasted-code"),l(!1)}}},_=()=>{l(!0)},B=()=>{l(!1),u(""),c("pasted-code")};return e.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center p-10 border-2 border-dashed border-gray-700 rounded-2xl max-w-2xl w-full",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("img",{src:"logo.svg",alt:"ANSUZ Logo",className:"w-16 h-16"}),e.jsx("h1",{className:"text-4xl font-bold text-cyan-accent",children:"ANSUZ"})]}),e.jsx("p",{className:"text-lg text-gray-500 mb-8",children:"Code Decoded by AI - Upload your code to reveal its wisdom through the power of Ansuz"}),e.jsx("input",{type:"file",ref:n,onChange:P,className:"hidden",multiple:!0}),e.jsx("input",{type:"file",ref:o,onChange:P,className:"hidden",webkitdirectory:"",directory:""}),s?e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"filename",className:"block text-sm font-medium text-gray-300 mb-2",children:"Filename (for single file only):"}),e.jsx("input",{id:"filename",type:"text",value:p,onChange:d=>c(d.target.value),placeholder:"e.g., main.py, app.js, config.yml",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-accent"})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"code-paste",className:"block text-sm font-medium text-gray-300 mb-2",children:"Paste your code here:"}),e.jsxs("div",{className:"mb-2 text-xs text-gray-400",children:[e.jsx("strong",{children:"Single file:"})," Just paste your code",e.jsx("br",{}),e.jsx("strong",{children:"Multiple files:"})," Use Claude Code format: ",e.jsx("code",{className:"bg-gray-700 px-1 rounded",children:"------ filepath ------"})," followed by code block",e.jsx("br",{}),e.jsx("strong",{children:"Legacy:"})," Also supports ",e.jsx("code",{className:"bg-gray-700 px-1 rounded",children:"### `filename.ext`"})," format"]}),e.jsx("textarea",{id:"code-paste",value:r,onChange:d=>u(d.target.value),placeholder:'Single file: Just paste your code here...\n\nMultiple files (Claude Code format):\n------ .claude/file.json ------\n``````\n{\n  "permissions": {\n    "allow": ["Bash(npm install)"]\n  }\n}\n``````\n\n------ components/Button.tsx ------\n``````\nexport const Button = () => {\n  return <button>Click me</button>;\n};\n``````\n\nLegacy format also supported:\n### `main.js`\n```javascript\nconsole.log(\'Hello\');\n```',rows:16,className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-accent font-mono text-sm resize-vertical"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx("button",{onClick:y,disabled:!r.trim(),className:"px-6 py-3 bg-blue-accent hover:bg-opacity-80 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-all duration-300 shadow-lg shadow-blue-accent/20",children:"Analyze Code"}),e.jsx("button",{onClick:B,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition-all duration-300",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>w("file"),className:"w-full sm:w-auto bg-blue-accent hover:bg-opacity-80 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 shadow-lg shadow-blue-accent/20",children:"Select File(s)"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"OR"}),e.jsx("button",{onClick:()=>w("folder"),className:"w-full sm:w-auto bg-cyan-accent hover:bg-opacity-80 text-gray-900 font-bold py-3 px-6 rounded-lg transition-all duration-300 shadow-lg shadow-cyan-accent/20",children:"Select Folder"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"OR"}),e.jsx("button",{onClick:_,className:"w-full sm:w-auto bg-orange-accent hover:bg-opacity-80 text-gray-900 font-bold py-3 px-6 rounded-lg transition-all duration-300 shadow-lg shadow-orange-accent/20",children:"Paste Code"})]})]})})},Le=({className:t="w-5 h-5"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),Ie=({className:t="w-5 h-5"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),G=({className:t="w-8 h-8"})=>e.jsxs("svg",{className:`animate-spin ${t}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Me=({className:t="w-5 h-5"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})}),ye=({node:t,selectedFile:a,onSelectFile:n,processingStatus:o,fileSummaries:s,summaryStatus:l,depth:r=0})=>{const[u,p]=N(r<2),c=t.children&&t.children.length>0,w=()=>{c?p(!u):n(t)};if(c){const B=[...t.children].sort((d,v)=>{const I=d.children.length>0,O=v.children.length>0;return I&&!O?-1:!I&&O?1:d.name.localeCompare(v.name)});return e.jsxs("div",{style:{paddingLeft:r>0?"0.5rem":"0"},children:[e.jsxs("div",{onClick:w,className:"flex items-center space-x-2 p-1.5 rounded-md cursor-pointer hover:bg-gray-700/50",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-accent flex-shrink-0"}),e.jsx("span",{className:"font-medium text-blue-light truncate",children:t.name})]}),u&&e.jsx("div",{className:"mt-1 border-l border-gray-700 ml-2.5",children:B.map(d=>e.jsx(ye,{node:d,selectedFile:a,onSelectFile:n,processingStatus:o,fileSummaries:s,summaryStatus:l,depth:r+1},d.path))})]})}const P=(a==null?void 0:a.path)===t.path,x=o.get(t.path)??"idle",y=l.get(t.path),_=s.get(t.path);return e.jsx("div",{style:{paddingLeft:r>0?"0.5rem":"0"},children:e.jsxs("div",{onClick:w,className:`group relative flex items-center justify-between space-x-2 p-1.5 rounded-md cursor-pointer hover:bg-gray-700/50 transition-colors duration-200 ${P?"bg-blue-accent/20 text-blue-light":"text-gray-500"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(Le,{className:"w-5 h-5 text-cyan-accent flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.name})]}),e.jsxs("div",{className:"flex-shrink-0 w-4 h-4 flex items-center justify-center",children:[x==="processing"&&e.jsx(G,{className:"w-4 h-4 text-blue-accent"}),x==="done"&&e.jsx(Me,{className:"w-4 h-4 text-green-accent"}),x==="idle"&&y==="summarizing"&&e.jsx(G,{className:"w-4 h-4 text-orange-accent"})]}),y==="done"&&_&&e.jsx("div",{className:"absolute left-6 top-full mt-2 w-72 p-3 bg-gray-900 border border-gray-700 rounded-md shadow-lg text-sm invisible group-hover:visible z-50 transition-opacity duration-200 opacity-0 group-hover:opacity-100",children:e.jsx("p",{className:"text-blue-light/90 whitespace-pre-wrap",children:_})})]})})},Te=t=>{const{node:a,selectedFile:n,onSelectFile:o,onProcessAll:s,processingStatus:l,isProcessingQueueActive:r,processingQueueLength:u,remainingFilesToProcess:p,fileSummaries:c,summaryStatus:w,projectSummary:P,isProjectSummaryLoading:x,onLogout:y}=t,_=()=>{if(p===0)return"All Files Analyzed";if(u>0)return`Processing... (${p} left)`;const d=Array.from(l.values()).some(v=>v==="processing");return d&&p>1?`Queue ${p} Remaining Files`:p===1?d?"Queue Last File":"Analyze Last File":`Analyze ${p} Files`};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-800",children:[e.jsxs("div",{className:"p-3 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-blue-light",children:"File Explorer"}),y&&e.jsx("button",{onClick:y,className:"bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white px-3 py-1.5 rounded-md transition-colors duration-200 text-xs font-medium",children:"Logout"})]}),e.jsxs("div",{className:"mt-2 mb-4 p-2 bg-gray-900/50 rounded-md min-h-[6rem]",children:[e.jsx("h3",{className:"text-sm font-bold text-cyan-accent mb-1",children:"Project Summary"}),x&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Generating..."})]}),!x&&P&&e.jsx("div",{className:"prose prose-invert max-w-none prose-sm prose-p:text-blue-light/90 prose-p:my-2",children:e.jsx(ce,{remarkPlugins:[de],children:P})}),!x&&!P&&e.jsx("p",{className:"text-sm text-gray-600",children:"Upload files to generate a summary."})]}),e.jsxs("button",{onClick:s,disabled:p===0,className:`w-full font-bold py-2 px-4 rounded-lg transition-all duration-300 text-sm flex items-center justify-center space-x-2 ${p===0?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-green-accent hover:bg-opacity-80 text-gray-900"}`,children:[r?e.jsx(G,{className:"w-4 h-4"}):null,e.jsx("span",{children:_()})]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-2",children:e.jsx(ye,{node:a,selectedFile:n,onSelectFile:o,processingStatus:l,fileSummaries:c,summaryStatus:w})})]})},ge=({className:t="w-5 h-5"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.553L16.5 21.75l-.398-1.197a3.375 3.375 0 00-2.456-2.456L12.5 18l1.197-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.197a3.375 3.375 0 002.456 2.456L20.5 18l-1.197.398a3.375 3.375 0 00-2.456 2.456z"})}),Re=t=>{var n;switch((n=t.split(".").pop())==null?void 0:n.toLowerCase()){case"js":case"jsx":return"javascript";case"ts":case"tsx":return"typescript";case"py":return"python";case"java":return"java";case"html":return"html";case"css":return"css";case"json":return"json";case"md":return"markdown";case"yml":case"yaml":return"yaml";default:return"clike"}},_e=(t,a,n)=>{if(!a)return null;let o=t.indexOf(a,n);if(o!==-1)return{index:o,content:a};const s=a.replace(/\n/g,`\r
`);if(s!==a&&(o=t.indexOf(s,n),o!==-1))return{index:o,content:s};const l=c=>c.trim().replace(/\s+/g," "),r=l(a),u=t.substring(n).split(`
`);let p=n;for(let c=0;c<u.length;c++){for(let w=1;w<=Math.min(5,u.length-c);w++){const x=u.slice(c,c+w).join(`
`);if(l(x)===r){const y=u.slice(0,c).join(`
`);return{index:n+(c>0?y.length+1:0),content:x}}}p+=u[c].length+1}return null},Oe=({explanation:t,isLoading:a,fileName:n,code:o,onDeepDive:s,deepDiveStatus:l})=>{const[r,u]=N(null),[p,c]=N(null),w=V(null),P=V(null),x=V([]),y=V([]);te(()=>{const m=(t==null?void 0:t.blocks.length)??0;x.current=x.current.slice(0,m)},[t]);const _={behavior:"smooth",block:"center",inline:"nearest"},B=K(()=>{const m=new Map;if(!t||!o)return m;let h=0;return t.blocks.forEach((b,k)=>{const M=b.code_block;if(!M)return;const R=_e(o,M,h);if(!R){console.warn("Could not find code block in source. View might be inaccurate.",{block:M});return}const{index:S,content:$}=R,U=(o.substring(0,S).match(/\n/g)||[]).length+1,W=($.match(/\n/g)||[]).length,Q=U+W;for(let H=U;H<=Q;H++)m.set(H,{blockIndex:k});h=S+$.length}),m},[o,t]),d=K(()=>{const m=new Map;if(!B)return m;const h=new Set;for(const[b,k]of B.entries())h.has(k.blockIndex)||(m.set(k.blockIndex,b),h.add(k.blockIndex));return m},[B]),v=K(()=>(t==null?void 0:t.blocks.map((m,h)=>({...m,blockIndex:h})))??[],[t]);te(()=>{var m;p==="left"&&r!==null&&w.current&&((m=x.current[r])==null||m.scrollIntoView(_))},[r,p]),te(()=>{var m;if(p==="right"&&r!==null){const h=d.get(r);h&&((m=y.current[h])==null||m.scrollIntoView(_))}},[r,p,d]);const I=K(()=>o.split(`
`),[o]),O=Re(n),T=a&&(!t||t.blocks.length===0),z={...le,'pre[class*="language-"]':{...le['pre[class*="language-"]']||{},background:"transparent",margin:0,padding:"1em 0",whiteSpace:"pre",overflowX:"auto"},'code[class*="language-"]':{...le['code[class*="language-"]']||{},fontFamily:"'Fira Code', monospace",fontSize:"14px",whiteSpace:"pre"}},F=m=>{var S;const h=B.get(m),b={display:"block",width:"100%",transition:"background-color 0.2s"},k=(S=I[m-1])==null?void 0:S.trim();if(!h)return k!==""&&(b.opacity=.5),{style:b};const M=h.blockIndex;return r===M&&(b.backgroundColor="rgba(65, 72, 104, 0.5)"),{ref:$=>{$&&(y.current[m]=$)},style:b,onMouseEnter:()=>{c("left"),u(M)},onMouseLeave:()=>{c(null),u(null)}}};return e.jsxs("div",{className:"grid grid-cols-2 h-full font-mono",children:[e.jsx("div",{className:"col-span-1 h-full overflow-auto bg-gray-900",children:e.jsx(Se,{language:O,style:z,showLineNumbers:!0,wrapLines:!0,lineProps:F,PreTag:"div",children:o})}),e.jsx("div",{ref:w,className:"col-span-1 h-full overflow-y-auto bg-gray-800 border-l border-gray-700",children:e.jsxs("div",{className:"p-6 space-y-2 font-sans",children:[e.jsxs("div",{className:"pb-4 mb-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-light",children:"Code Explanations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hover over code on the left or an explanation below."})]}),T&&e.jsxs("div",{className:"col-span-1 h-full flex flex-col items-center justify-center text-gray-500",children:[e.jsx(G,{className:"w-12 h-12 text-blue-accent"}),e.jsxs("p",{className:"mt-4 text-lg font-sans",children:["Analyzing ",n,"..."]}),e.jsx("p",{className:"text-sm font-sans",children:"Explanations will appear here as they're generated."})]}),v.map(m=>{const h=m.blockIndex,b=l.isLoading&&l.blockIndex===h,k=m.explanation||"";return e.jsxs("div",{ref:M=>{typeof h=="number"&&(x.current[h]=M)},onMouseEnter:()=>{c("right"),u(h)},onMouseLeave:()=>{c(null),u(null)},className:`group p-4 rounded-lg transition-all duration-300 border ${r===h?"bg-gray-700/50 border-blue-accent/50":"bg-transparent border-transparent"}`,children:[e.jsx("div",{className:"prose prose-invert max-w-none prose-sm prose-p:text-blue-light prose-p:mb-6 prose-headings:text-cyan-accent prose-strong:text-orange-accent prose-code:text-orange-accent prose-code:before:content-[''] prose-code:after:content-[''] prose-li:text-blue-light prose-li:my-3 prose-ul:my-6 prose-ol:my-6",children:e.jsx(ce,{remarkPlugins:[de],children:k.trim()})}),e.jsx("div",{className:"mt-3",children:m.deep_dive_explanation?e.jsxs("div",{className:"mt-4 p-4 border-l-2 border-cyan-accent/50 bg-gray-900/30 rounded-r-lg",children:[e.jsxs("h4",{className:"font-bold text-sm text-cyan-accent flex items-center mb-2",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Deep Dive"]}),e.jsxs("div",{className:"prose prose-invert max-w-none prose-sm prose-p:text-blue-light/90 prose-p:mb-6 prose-strong:text-orange-accent prose-li:text-blue-light prose-li:my-3 prose-ul:my-6 prose-ol:my-6",children:[e.jsx(ce,{remarkPlugins:[de],children:m.deep_dive_explanation}),b&&e.jsx("span",{className:"inline-block w-2 h-4 bg-blue-light animate-pulse ml-1"})]})]}):k.trim()&&e.jsxs("button",{onClick:()=>s(h),disabled:l.isLoading,className:"flex items-center space-x-2 text-sm text-cyan-accent hover:text-white disabled:text-gray-600 disabled:cursor-not-allowed font-semibold py-1 px-2 rounded-md bg-gray-700/50 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-all duration-300",children:[b?e.jsx(G,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:b?"Analyzing...":"Deep Dive"})]})})]},`expl-${h}`)}),a&&!T&&e.jsxs("div",{ref:P,className:"flex items-center p-4 text-gray-500",children:[e.jsx(G,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"Generating explanation..."})]}),!a&&(t==null?void 0:t.blocks.length)===0&&!T&&e.jsx("div",{className:"flex items-center justify-center h-full text-gray-600 p-8 text-center",children:e.jsx("p",{children:"No explanation available. The file might be empty, unsupported, or an error occurred."})})]})})]})},ne="gemini-2.5-flash",Fe=t=>{if(!t)throw new Error("Gemini API key is not configured.")},re=t=>(Fe(t),new Ae({apiKey:t})),$e=(t,a,n)=>{const o=re(n);return a.trim()?(console.log(`ðŸ¤– API Call: Streaming bulk explanation for file "${t}" (${a.length} characters)`),o.models.generateContentStream({model:ne,contents:`Analyze the following code from the file \`${t}\`:

---
${a}
---`,config:{systemInstruction:`You are an expert software engineer acting as a code tutor. Your task is to analyze the provided code and generate concise, block-by-block explanations.

**CRITICAL STREAMING FORMAT:**
You MUST respond by streaming explanations as individual JSON objects, one per line:
{"code_block": "exact verbatim code snippet", "explanation": "markdown explanation"}
{"code_block": "next exact verbatim code snippet", "explanation": "markdown explanation"}
...

**CRITICAL RESPONSE FORMAT RULES:**
1. **ONE JSON OBJECT PER LINE:** Each code block and explanation pair must be a separate JSON object on its own line.
2. **VERBATIM CODE:** The "code_block" value MUST be an exact, verbatim, character-for-character copy of a snippet from the original file.
3. **SEQUENTIAL & NON-REPEATING:** Process the file sequentially from top to bottom. Once you explain a code block, DO NOT include it again.

**EXPLANATION & MARKDOWN STYLE RULES:**
- **MANDATORY Markdown:** All "explanation" values must be in well-formatted Markdown.
- **NO TABLES:** You MUST NOT use markdown tables. Use bulleted lists instead.
- **Paragraphs are REQUIRED:** Break up ideas into separate paragraphs (blank lines).
- **Correct Spacing for Lists:** Insert a blank line before starting any bulleted or numbered list.
- **Bulleted Lists for Enumerations:** Use bulleted lists (\`* item\`) for multiple items.
- **Bold for Emphasis:** Use **bold text** to highlight key terms.

**EXAMPLE OUTPUT:**
{"code_block": "function example(name, options) {\\n  // ...\\n}", "explanation": "This function \`example\` sets up a new component.\\n\\nIt accepts the following parameters:\\n\\n*   **name**: The unique identifier\\n*   **options**: Configuration object"}
{"code_block": "const result = process(data);", "explanation": "This line processes the input data and stores the result.\\n\\n**Important:** The process function handles validation internally."}`,temperature:.2}})):Promise.resolve({blocks:[{code_block:"// This file is empty.",explanation:"There is no code in this file to analyze."}]})},De=`You are a senior software engineer and code architect providing a detailed analysis.

The user has already seen this initial explanation:
"""
{original_explanation}
"""

Your task is to provide a "deep dive" analysis. Focus on the "why" and "how else."

**DEEP DIVE ANALYSIS POINTS:**
*   **Design Patterns:** Name any relevant patterns and explain their use here.
*   **Nuances & Trade-offs:** Discuss why this approach was chosen over alternatives (e.g., performance, readability).
*   **Best Practices & Improvements:** Does it follow modern best practices? Suggest specific improvements.
*   **Broader Context:** How might this code interact with a larger application?

**CRITICAL MARKDOWN FORMATTING RULES:**
- **MANDATORY Markdown:** Your entire response must be well-formatted Markdown.
- **Use Paragraphs:** Separate distinct ideas with blank lines to form paragraphs.
- **Correct List Spacing:** YOU MUST insert a blank line before starting any list. This is critical for readability.
    - **CORRECT:**
      Here are the trade-offs:

      * **Performance:** This is faster.
      * **Readability:** This is less clear.

    - **INCORRECT (DO NOT DO THIS):**
      Here are the trade-offs:
      * **Performance:** This is faster.
      * **Readability:** This is less clear.
- **Use Bullet Points:** You MUST use bulleted lists to enumerate points, alternatives, or improvements.
- **Use Bold:** Use **bold text** to emphasize key terms.
`,Be=(t,a,n)=>{const o=re(n);return console.log(`ðŸ¤– API Call: Deep dive analysis for code block in "${a}" (${t.code_block.length} characters)`),o.models.generateContentStream({model:ne,contents:`Here is the code from \`${a}\` that needs a deep dive:

\`\`\`
${t.code_block}
\`\`\``,config:{systemInstruction:De.replace("{original_explanation}",t.explanation),temperature:.4}})},Ue=async function*(t,a){if(t.length===0)return;const n=re(a),o=`You are a code analysis expert. You will receive multiple files from a project and must provide individual file summaries followed by an overall project summary.

**CRITICAL STREAMING FORMAT:**
You MUST respond by streaming summaries in this exact order:
1. First, provide individual file summaries in JSON format: {"type": "file_summary", "path": "file_path", "summary": "2-3 sentence summary"}
2. After all file summaries, provide the project summary: {"type": "project_summary", "summary": "overall summary with paragraph breaks"}

**File Summary Rules:**
- Each file summary must be 2-3 sentences maximum
- Focus on the file's main purpose and role
- No markdown formatting
- Be concise but informative

**Project Summary Rules:**
- Maximum 3 sentences total
- Use 2-3 short paragraphs separated by blank lines
- Synthesize the overall project purpose from all files
- Focus on high-level architecture and goals

**Example Output Format:**
{"type": "file_summary", "path": "src/main.ts", "summary": "This is the main entry point that initializes the application. It sets up routing and starts the server."}
{"type": "file_summary", "path": "src/utils.ts", "summary": "Contains utility functions for data processing and validation. Provides helper methods used throughout the application."}
{"type": "project_summary", "summary": "This project is a web application backend built with TypeScript.\\n\\nIt provides REST API endpoints for data management and includes comprehensive utility functions.\\n\\nThe architecture follows modern Node.js patterns with clear separation of concerns."}

**IMPORTANT:** Output each JSON object on its own line. Do not wrap in markdown or add extra formatting.`,s=t.map(l=>`=== FILE: ${l.path} ===
${l.content}

`).join("");console.log(`ðŸ¤– API Call: Streaming summaries for ${t.length} files (${s.length} total characters)`);try{const l=await n.models.generateContentStream({model:ne,contents:`Analyze these project files and provide streaming summaries:

${s}`,config:{systemInstruction:o,temperature:.2}});let r="",u=0,p=!1;for await(const c of l)if(c.text){r+=c.text;const w=r.split(`
`);r=w.pop()||"";for(const P of w){const x=P.trim();if(x&&x.startsWith("{"))try{const y=JSON.parse(x);y.type==="file_summary"&&y.path&&y.summary?(u++,yield{type:"file_summary",path:y.path,summary:y.summary}):y.type==="project_summary"&&y.summary&&(p=!0,yield{type:"project_summary",summary:y.summary})}catch{console.warn("Skipping invalid JSON line:",x)}}}if(r.trim()&&r.trim().startsWith("{"))try{const c=JSON.parse(r.trim());c.type==="file_summary"&&c.path&&c.summary?(u++,yield{type:"file_summary",path:c.path,summary:c.summary}):c.type==="project_summary"&&c.summary&&(p=!0,yield{type:"project_summary",summary:c.summary})}catch{console.warn("Skipping invalid JSON in buffer:",r.trim())}console.log(`ðŸ“Š Summary streaming completed: ${u} file summaries, project summary: ${p?"received":"MISSING"}`),u>0&&!p&&console.warn("âš ï¸ Project summary was not generated by streaming API")}catch(l){console.error("Stream processing failed:",l),yield{type:"error",message:"Failed to generate summaries due to streaming error."}}},ze=async(t,a)=>{if(t.length===0)return"";const n=re(a),o=`You are a project architect. You will be given a list of files and their individual summaries. Your task is to synthesize these into a single, high-level project summary.

**Formatting Rules:**
- The entire summary MUST be a maximum of 3 sentences total.
- You MUST use 2-3 short paragraphs for visual separation. A paragraph is text separated by a blank line.

**EXAMPLE OF PERFECT OUTPUT:**

This project orchestrates data pipelines within a Databricks environment.

It includes utilities for determining the runtime context and managing environment-specific configurations.

The primary goal is to ensure that data jobs run consistently across different stages like dev, test, and prod.`,s=t.map(r=>`File: ${r.path}
Summary: ${r.summary}`).join(`

`);return console.log(`ðŸ¤– API Call: Generating project summary from ${t.length} file summaries`),(await n.models.generateContent({model:ne,contents:`Here are the file summaries for a project:

${s}

Based on these, what is the overall purpose of this project?`,config:{systemInstruction:o,temperature:.3}})).text},Ye=({onApiKeySubmit:t,showLogout:a=!1,onLogout:n})=>{const[o,s]=N(""),l=r=>{r.preventDefault(),o.trim()&&(localStorage.setItem("gemini_api_key",o.trim()),t(o.trim()))};return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900",children:[a&&n&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{onClick:n,className:"bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white px-4 py-2 rounded-lg transition-colors duration-200 text-sm font-medium",children:"Logout"})}),e.jsxs("div",{className:"text-center p-10 border-2 border-dashed border-gray-700 rounded-2xl max-w-2xl w-full",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("img",{src:"logo.svg",alt:"ANSUZ Logo",className:"w-16 h-16"}),e.jsx("h1",{className:"text-4xl font-bold text-cyan-accent",children:"ANSUZ"})]}),e.jsx("p",{className:"text-lg text-gray-500 mb-8",children:"Code Decoded by AI - Enter your Gemini API Key to unlock the wisdom of Ansuz"}),e.jsxs("form",{onSubmit:l,className:"max-w-md mx-auto",children:[e.jsx("label",{htmlFor:"api-key-input",className:"sr-only",children:"Gemini API Key"}),e.jsx("input",{id:"api-key-input",type:"password",value:o,onChange:r=>s(r.target.value),placeholder:"Enter your Gemini API Key",className:"w-full bg-gray-800 border-2 text-blue-light rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-accent transition-colors border-gray-700 mb-4",autoFocus:!0}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"w-full bg-blue-accent hover:bg-opacity-80 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 shadow-lg shadow-blue-accent/20",children:"Continue"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-6",children:["Your API key is stored securely in your browser's local storage. You can get a key from ",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-accent hover:underline",children:"Google AI Studio"}),"."]})]})]})},se=(t,a=[])=>{if(t.content!==null&&a.push(t),t.children)for(const n of t.children)se(n,a);return a},fe=t=>{const a=t.trim().replace(/\s+/g," ");let n=0;for(let o=0;o<a.length;o++){const s=a.charCodeAt(o);n=(n<<5)-n+s,n=n&n}return n.toString(36)},xe=(t,a,n)=>{if(!(t instanceof Error))return"An unexpected error occurred.";const o=a==="PLACEHOLDER_API_KEY";if(t.message.includes("API key not valid")||t.message.includes("API key is invalid")){const s=o?"The API Key provided by the environment appears to be invalid.":"The provided API Key is invalid. Please enter a valid key.";return o||(localStorage.removeItem("gemini_api_key"),n(null)),s}return t.message.includes("parse")?"The response from the AI was not in the expected format.":"An error occurred while communicating with the API."},Je=()=>{const[t,a]=N(null),[n,o]=N(()=>"PLACEHOLDER_API_KEY"),[s,l]=N(null),[r,u]=N(new Map),[p,c]=N(new Map),[w,P]=N([]),[x,y]=N(!1),[_,B]=N({file:null,blockIndex:null,isLoading:!1}),[d,v]=N(new Map),[I,O]=N(new Map),[T,z]=N(""),[F,m]=N(new Map),[h,b]=N(!1),k=K(()=>s?r.get(s.path)??null:null,[s,r]),M=K(()=>s?p.get(s.path)==="processing":!1,[s,p]),R=w.length>0||Array.from(p.values()).some(i=>i==="processing"),S=K(()=>t?se(t).filter(g=>!r.has(g.path)).length:0,[t,r]),$=i=>{localStorage.setItem("gemini_api_key",i),o(i)},U=()=>{localStorage.removeItem("gemini_api_key"),o(null),a(null),l(null),u(new Map),c(new Map),P([]),v(new Map),O(new Map),z(""),m(new Map)},W=X(async i=>{if(i.length===0||!n)return;b(!0);const g=new Map(i.map(L=>[L.path,"summarizing"]));m(g);try{const L=i.map(f=>({path:f.path,name:f.name,content:f.content||""})),A=new Map;let C=!1;for await(const f of Ue(L,n))if(f.type==="file_summary")A.set(f.path,f.summary),g.set(f.path,"done"),O(new Map(A)),m(new Map(g));else if(f.type==="project_summary")z(f.summary),C=!0;else if(f.type==="error")throw new Error(f.message);if(!C&&A.size>0){console.warn("Project summary not received from streaming API, generating fallback...");try{const f=await ze(Array.from(A.entries()).map(([j,E])=>({path:j,summary:E})),n);z(f)}catch(f){console.error("Fallback project summary also failed:",f),z("Unable to generate project summary.")}}}catch(L){console.error("Failed to generate summaries:",L);const A=new Map;i.forEach(C=>{A.set(C.path,"Failed to generate summary."),g.set(C.path,"done")}),O(A),m(new Map(g)),z("Could not generate a project summary.")}b(!1)},[n]),Q=X(i=>{a(i);const g=se(i);g.length>0&&(W(g),g.length===1&&l(g[0]))},[W]),H=X(async i=>{if(!(!i.content||!n||p.get(i.path)==="done"||p.get(i.path)==="processing")){c(g=>new Map(g).set(i.path,"processing")),u(g=>new Map(g).set(i.path,{blocks:[]}));try{const g=await $e(i.name,i.content,n);let L="";const A=[];let C=0,f=0;for await(const j of g)if(j.text){L+=j.text;const E=L.split(`
`);L=E.pop()||"";for(const D of E){const Y=D.trim();if(Y&&Y.startsWith("{"))try{const J=JSON.parse(Y);if(J.code_block&&J.explanation){const q=fe(J.code_block);let ae=J.explanation;const me=d.get(q);me?(ae=me,C++):(v(oe=>new Map(oe).set(q,ae)),f++),A.push({code_block:J.code_block,explanation:ae}),u(oe=>{const ue=new Map(oe);return ue.set(i.path,{blocks:[...A]}),ue})}}catch{console.warn("Skipping invalid JSON line:",Y)}}}if(L.trim()&&L.trim().startsWith("{"))try{const j=JSON.parse(L.trim());if(j.code_block&&j.explanation){const E=fe(j.code_block);let D=j.explanation;const Y=d.get(E);Y?(D=Y,C++):(v(J=>new Map(J).set(E,D)),f++),A.push({code_block:j.code_block,explanation:D}),u(J=>{const q=new Map(J);return q.set(i.path,{blocks:[...A]}),q})}}catch{console.warn("Skipping invalid JSON in buffer:",L.trim())}(C>0||f>0)&&console.log(`ðŸ“‹ Explanation cache stats for ${i.name}: ${f} new explanations, ${C} reused from cache`)}catch(g){console.error(`Error fetching explanation for ${i.name}:`,g);const L=`Failed to analyze file. ${xe(g,n,o)}`;u(A=>{const C=new Map(A),f={code_block:`// Error for ${i.name}`,explanation:L};return C.set(i.path,{blocks:[f]}),C})}finally{c(g=>new Map(g).set(i.path,"done"))}}},[p,n,d]),we=X(i=>{i.path!==(s==null?void 0:s.path)&&(l(i),H(i))},[s,H]),je=X(()=>{if(!t)return;const i=se(t).filter(g=>!r.has(g.path));P(i)},[t,r]),ve=async i=>{if(!s||!n||_.isLoading)return;const g=r.get(s.path),L=g==null?void 0:g.blocks[i];if(L){B({file:s.path,blockIndex:i,isLoading:!0});try{const A=await Be(L,s.name,n);u(C=>{const f=new Map(C),j=f.get(s.path);if(j){const E=[...j.blocks];E[i]={...E[i],deep_dive_explanation:""},f.set(s.path,{...j,blocks:E})}return f});for await(const C of A)u(f=>{const j=new Map(f),E=j.get(s.path);if(E){const D=[...E.blocks],Y=D[i];D[i]={...Y,deep_dive_explanation:(Y.deep_dive_explanation||"")+C.text},j.set(s.path,{...E,blocks:D})}return j})}catch(A){if(console.error("Deep dive failed:",A),!s)return;const C=`**Deep Dive Failed:** ${xe(A,n,o)}`;u(f=>{const j=new Map(f),E=j.get(s.path);if(E){const D=[...E.blocks];D[i]={...D[i],deep_dive_explanation:C},j.set(s.path,{...E,blocks:D})}return j})}finally{B({file:null,blockIndex:null,isLoading:!1})}}};return te(()=>{if(w.length===0)return;const i=w[0];if(p.get(i.path)==="processing"||r.has(i.path)){P(g=>g.slice(1));return}H(i).then(()=>{P(g=>g.slice(1))})},[w,H,p,r]),x?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900 text-blue-light",children:[e.jsx(G,{className:"w-16 h-16 text-blue-accent"}),e.jsx("p",{className:"mt-4 text-xl",children:"Loading files..."})]}):n?t?e.jsxs("div",{className:"flex h-screen max-h-screen overflow-hidden text-sm",children:[e.jsx("aside",{className:"w-1/4 min-w-[300px] max-w-[450px] border-r border-gray-700",children:e.jsx(Te,{node:t,selectedFile:s,onSelectFile:we,onProcessAll:je,processingStatus:p,isProcessingQueueActive:R,processingQueueLength:w.length,remainingFilesToProcess:S,fileSummaries:I,summaryStatus:F,projectSummary:T,isProjectSummaryLoading:h,onLogout:U})}),e.jsx("main",{className:"w-3/4 flex-grow bg-gray-900",children:s?e.jsx(Oe,{explanation:k,isLoading:M,fileName:s.name,code:s.content||"",onDeepDive:ve,deepDiveStatus:_}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-600 p-8 text-center",children:e.jsxs("p",{children:["Select a file from the explorer to begin analysis.",e.jsx("br",{}),"You can hover over files to see a brief summary."]})})})]}):e.jsx(Pe,{onProjectReady:Q,setIsLoading:y}):e.jsx(Ye,{onApiKeySubmit:$})},be=document.getElementById("root");if(!be)throw new Error("Could not find root element to mount to");const He=Ne.createRoot(be);He.render(e.jsx(ke.StrictMode,{children:e.jsx(Je,{})}));
